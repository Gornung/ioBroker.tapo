{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["/*\n * Created with @iobroker/create-adapter v2.1.1\n */\n\n// The adapter-core module gives you access to the core ioBroker functions\n// you need to create an adapter\nimport * as utils from \"@iobroker/adapter-core\";\nimport axios, { AxiosInstance } from \"axios\";\nimport crypto from \"crypto\";\nimport https from \"https\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport Json2iob from \"./lib/json2iob\";\nimport { TAPOCamera } from \"./lib/utils/camera/tapoCamera\";\nimport L510E from \"./lib/utils/l510e\";\nimport L520E from \"./lib/utils/l520e\";\nimport L530 from \"./lib/utils/l530\";\nimport P100 from \"./lib/utils/p100\";\nimport P110 from \"./lib/utils/p110\";\nclass Tapo extends utils.Adapter {\n  private devices: { [key: string]: any };\n  private deviceObjects: { [key: string]: any };\n  private json2iob: Json2iob;\n  private secret: Buffer;\n  private requestClient: AxiosInstance;\n  updateInterval: any = null;\n  reLoginTimeout: any = null;\n  refreshTokenTimeout: any = null;\n  session: any = {};\n  refreshTimeout: any;\n  refreshTokenInterval: any;\n  termId: any;\n  public constructor(options: Partial<utils.AdapterOptions> = {}) {\n    super({\n      ...options,\n      name: \"tapo\",\n    });\n    this.on(\"ready\", this.onReady.bind(this));\n    this.on(\"stateChange\", this.onStateChange.bind(this));\n    this.on(\"unload\", this.onUnload.bind(this));\n    this.devices = {};\n    this.deviceObjects = {};\n    this.json2iob = new Json2iob(this);\n    this.requestClient = axios.create({\n      httpsAgent: new https.Agent({\n        rejectUnauthorized: false,\n      }),\n    });\n    this.secret = Buffer.from([\n      54, 101, 100, 55, 100, 57, 55, 102, 51, 101, 55, 51, 52, 54, 55, 102, 56, 97, 53, 98, 97, 98, 57, 48, 98, 53, 55, 55, 98, 97, 52, 99,\n    ]);\n  }\n\n  /**\n   * Is called when databases are connected and adapter received configuration.\n   */\n  private async onReady(): Promise<void> {\n    this.setState(\"info.connection\", false, true);\n    if (this.config.interval < 0.5) {\n      this.log.info(\"Set interval to minimum 0.5\");\n      this.config.interval = 0.5;\n    }\n    if (!this.config.username || !this.config.password) {\n      this.log.error(\"Please set username and password in the instance settings\");\n      return;\n    }\n\n    this.updateInterval = null;\n    this.reLoginTimeout = null;\n    this.refreshTokenTimeout = null;\n    this.session = {};\n    this.subscribeStates(\"*\");\n\n    const termIdState = await this.getStateAsync(\"termId\");\n    if (termIdState && termIdState.val) {\n      this.termId = termIdState.val;\n    } else {\n      await this.setObjectNotExistsAsync(\"termId\", {\n        type: \"state\",\n        common: {\n          name: \"Terminal ID\",\n          write: false,\n          read: true,\n          type: \"string\",\n          role: \"text\",\n        },\n        native: {},\n      });\n      this.termId = uuidv4();\n      await this.setStateAsync(\"termId\", this.termId, true);\n    }\n\n    this.log.info(\"Login tp TAPO App\");\n    await this.login();\n    if (this.session.token) {\n      await this.getDeviceList();\n    } else {\n      this.log.warn(\"Login failed using cached device list\");\n      const deviceListState = await this.getStateAsync(\"deviceList\");\n      if (deviceListState && deviceListState.val) {\n        this.log.info(\"Use cached device list\");\n        this.devices = JSON.parse(deviceListState.val);\n        for (const id in this.devices) {\n          if (this.devices[id].ip) {\n            const initResult = await this.initDevice(id)\n              .then(() => {\n                this.log.info(`Initialized ${id}`);\n              })\n              .catch((e) => {\n                this.log.error(e);\n              });\n            this.log.debug(`initResult ${id} ${JSON.stringify(initResult)}`);\n          }\n        }\n      }\n    }\n\n    this.log.info(\"Wait for connections for non camera devices\");\n    await this.sleep(10000);\n    this.log.info(\"Start first Update\");\n    await this.updateDevices();\n    this.updateInterval = setInterval(async () => {\n      await this.updateDevices();\n    }, this.config.interval * 1000);\n  }\n  async login(): Promise<void> {\n    let body = JSON.stringify({\n      appVersion: \"2.8.21\",\n      refreshTokenNeeded: true,\n      platform: \"iOS 14.8\",\n      cloudPassword: this.config.password,\n      terminalUUID: this.termId,\n      cloudUserName: this.config.username,\n      terminalName: \"ioBroker\",\n      terminalMeta: \"3\",\n      appType: \"TP-Link_Tapo_iOS\",\n    });\n    let path = \"api/v2/account/login\";\n    const mfaIdState = await this.getStateAsync(\"mfaId\");\n    if (mfaIdState && mfaIdState.val) {\n      if (!this.config.mfa) {\n        this.log.error(\"Please set mfa in the instance settings\");\n        return;\n      }\n\n      body = JSON.stringify({\n        cloudUserName: this.config.username,\n        MFAProcessId: mfaIdState.val,\n        appType: \"TP-Link_Tapo_iOS\",\n        MFAType: 2,\n        code: this.config.mfa,\n        terminalBindEnabled: true,\n      });\n      path = \"api/v2/account/checkMFACodeAndLogin\";\n      await this.setStateAsync(\"mfaId\", \"\", true);\n    }\n    const md5 = crypto.createHash(\"md5\").update(body).digest(\"base64\");\n    this.log.debug(md5);\n    const content = md5 + \"\\n9999999999\\nfee66616-58dd-4bcb-be79-fe092d800a21\\n/\" + path;\n    const signature = crypto.createHmac(\"sha1\", this.secret).update(content).digest(\"hex\");\n    await this.requestClient({\n      method: \"post\",\n      url:\n        \"https://n-wap-gw.tplinkcloud.com/\" +\n        path +\n        \"?termID=\" +\n        this.termId +\n        \"&appVer=2.8.21&locale=de_DE&appName=TP-Link_Tapo_iOS&netType=wifi&model=iPhone10%2C5&termName=iPhone&termMeta=3&brand=TPLINK&ospf=iOS%2014.8\",\n      headers: {\n        \"Content-Type\": \"application/json;UTF-8\",\n        Accept: \"*/*\",\n        \"User-Agent\": \"Tapo/2.8.21 (iPhone; iOS 14.8; Scale/3.00)\",\n        \"Accept-Language\": \"de-DE;q=1, uk-DE;q=0.9, en-DE;q=0.8\",\n        \"X-Authorization\":\n          \"Timestamp=9999999999, Nonce=fee66616-58dd-4bcb-be79-fe092d800a21, AccessKey=4d11b6b9d5ea4d19a829adbb9714b057, Signature=\" +\n          signature,\n      },\n      data: body,\n    })\n      .then(async (res) => {\n        this.log.debug(JSON.stringify(res.data));\n        if (res.data.error_code) {\n          this.log.error(JSON.stringify(res.data));\n          return;\n        }\n        if (res.data.result?.MFAProcessId) {\n          this.log.info(\"Found MFA Process please enter MFA in the instance settings\");\n          await this.setObjectNotExistsAsync(\"mfaId\", {\n            type: \"state\",\n            common: {\n              name: \"MFA Id\",\n              write: false,\n              read: true,\n              type: \"string\",\n              role: \"text\",\n            },\n            native: {},\n          });\n          await this.setStateAsync(\"mfaId\", res.data.result?.MFAProcessId, true);\n\n          const body = JSON.stringify({\n            cloudPassword: this.config.password,\n            locale: \"de_DE\",\n            terminalUUID: this.termId,\n            cloudUserName: this.config.username,\n            appType: \"TP-Link_Tapo_iOS\",\n          });\n\n          const path = \"api/v2/account/getEmailVC4TerminalMFA\";\n\n          const md5 = crypto.createHash(\"md5\").update(body).digest(\"base64\");\n          this.log.debug(md5);\n          const content = md5 + \"\\n9999999999\\nfee66616-58dd-4bcb-be79-fe092d800a21\\n/\" + path;\n          const signature = crypto.createHmac(\"sha1\", this.secret).update(content).digest(\"hex\");\n          await this.requestClient({\n            method: \"post\",\n            url:\n              \"https://n-wap-gw.tplinkcloud.com/\" +\n              path +\n              \"?termID=\" +\n              this.termId +\n              \"&appVer=2.8.21&locale=de_DE&appName=TP-Link_Tapo_iOS&netType=wifi&model=iPhone10%2C5&termName=iPhone&termMeta=3&brand=TPLINK&ospf=iOS%2014.8\",\n            headers: {\n              \"Content-Type\": \"application/json;UTF-8\",\n              Accept: \"*/*\",\n              \"User-Agent\": \"Tapo/2.8.21 (iPhone; iOS 14.8; Scale/3.00)\",\n              \"Accept-Language\": \"de-DE;q=1, uk-DE;q=0.9, en-DE;q=0.8\",\n              \"X-Authorization\":\n                \"Timestamp=9999999999, Nonce=fee66616-58dd-4bcb-be79-fe092d800a21, AccessKey=4d11b6b9d5ea4d19a829adbb9714b057, Signature=\" +\n                signature,\n            },\n            data: body,\n          })\n            .then(async (res) => {\n              this.log.debug(JSON.stringify(res.data));\n              if (res.data.error_code) {\n                this.log.error(JSON.stringify(res.data));\n                return;\n              }\n            })\n            .catch((error) => {\n              this.log.error(error);\n              error.response && this.log.error(JSON.stringify(error.response.data));\n            });\n          return;\n        }\n\n        if (!res.data.result || !res.data.result.token) {\n          this.log.error(\"Login failed\");\n          this.log.error(JSON.stringify(res.data));\n          return;\n        }\n        this.session = res.data.result;\n        if (this.session.token) {\n          this.log.info(\"Login succesfull\");\n          this.setState(\"info.connection\", true, true);\n        }\n        return;\n      })\n      .catch((error) => {\n        this.log.error(error);\n        error.response && this.log.error(JSON.stringify(error.response.data));\n      });\n  }\n\n  async getDeviceList(): Promise<void> {\n    const body =\n      '{\"index\":0,\"deviceTypeList\":[\"SMART.TAPOBULB\",\"SMART.TAPOPLUG\",\"SMART.IPCAMERA\",\"SMART.TAPOHUB\",\"SMART.TAPOSENSOR\",\"SMART.TAPOSWITCH\"],\"limit\":30}';\n    const md5 = crypto.createHash(\"md5\").update(body).digest(\"base64\");\n    this.log.debug(md5);\n    const content = md5 + \"\\n9999999999\\nfee66616-58dd-4bcb-be79-fe092d800a21\\n/api/v2/common/getDeviceListByPage\";\n    const signature = crypto.createHmac(\"sha1\", this.secret).update(content).digest(\"hex\");\n    await this.requestClient({\n      method: \"post\",\n      url: `https://n-euw1-wap-gw.tplinkcloud.com/api/v2/common/getDeviceListByPage?token=${this.session.token}&termID=${this.termId}&appVer=2.8.21&locale=de_DE&appName=TP-Link_Tapo_iOS&netType=wifi&model=iPhone10%2C5&termName=iPhone&termMeta=3&brand=TPLINK&ospf=iOS%2014.8`,\n      headers: {\n        \"Content-Type\": \"application/json;UTF-8\",\n        \"Content-MD5\": md5,\n        Accept: \"*/*\",\n        \"User-Agent\": \"Tapo/2.8.21 (iPhone; iOS 14.8; Scale/3.00)\",\n        \"Accept-Language\": \"de-DE;q=1, uk-DE;q=0.9, en-DE;q=0.8\",\n        \"X-Authorization\":\n          \"Timestamp=9999999999, Nonce=fee66616-58dd-4bcb-be79-fe092d800a21, AccessKey=4d11b6b9d5ea4d19a829adbb9714b057, Signature=\" +\n          signature,\n      },\n      data: body,\n    })\n      .then(async (res) => {\n        this.log.debug(JSON.stringify(res.data));\n        if (res.data.error_code) {\n          this.log.error(JSON.stringify(res.data));\n          return;\n        }\n        this.log.info(`Found ${res.data.result?.totalNum} devices`);\n\n        for (const device of res.data.result?.deviceList) {\n          const id = device.deviceId;\n          this.devices[id] = device;\n          let name = device.alias;\n          if (this.isBase64(device.alias)) {\n            name = Buffer.from(device.alias, \"base64\").toString(\"utf8\");\n          }\n\n          await this.setObjectNotExistsAsync(id, {\n            type: \"device\",\n            common: {\n              name: name,\n            },\n            native: {},\n          });\n          await this.setObjectNotExistsAsync(id + \".remote\", {\n            type: \"channel\",\n            common: {\n              name: \"Remote Controls\",\n            },\n            native: {},\n          });\n\n          const remoteArray = [\n            { command: \"refresh\", name: \"True = Refresh\" },\n            { command: \"setPowerState\", name: \"True = On, False = Off\" },\n            { command: \"setAlertConfig\", name: \"True = On, False = Off\" },\n            { command: \"setLensMaskConfig\", name: \"True = On, False = Off\" },\n            { command: \"setForceWhitelampState\", name: \"True = On, False = Off\" },\n            {\n              command: \"setBrightness\",\n              name: \"Set Brightness for Light devices\",\n              type: \"number\",\n              role: \"level.brightness\",\n              def: 5,\n            },\n            {\n              command: \"setColorTemp\",\n              name: \"Set Color Temp for Light devices\",\n              type: \"number\",\n              role: \"level.color.temperature\",\n              def: 3000,\n            },\n            {\n              command: \"setColor\",\n              name: \"Set Color for Light devices (hue, saturation)\",\n              def: \"30, 100\",\n              type: \"string\",\n            },\n          ];\n          remoteArray.forEach((remote) => {\n            this.extendObjectAsync(id + \".remote.\" + remote.command, {\n              type: \"state\",\n              common: {\n                name: remote.name || \"\",\n                type: remote.type || \"boolean\",\n                role: remote.role || \"switch\",\n                def: remote.def != null ? remote.def : false,\n                write: true,\n                read: true,\n              },\n              native: {},\n            });\n          });\n          this.json2iob.parse(id, device);\n\n          //try new API\n\n          await this.requestClient({\n            method: \"get\",\n            url: \"https://euw1-app-server.iot.i.tplinknbu.com/v1/things/\" + id + \"/details\",\n            headers: {\n              \"x-locale\": \"de\",\n              Authorization: \"ut|\" + this.session.token,\n              \"app-cid\": \"app:TP-Link_Tapo_iOS:\" + this.termId,\n              \"x-ospf\": \"iOS 14.8\",\n              \"x-app-name\": \"TP-Link_Tapo_iOS\",\n              Accept: \"*/*\",\n              \"Accept-Language\": \"de-DE;q=1, uk-DE;q=0.9, en-DE;q=0.8\",\n              \"Content-Type\": \"application/json;UTF-8\",\n              \"User-Agent\": \"Tapo/2.9.7 (iPhone; iOS 14.8; Scale/3.00)\",\n              \"x-term-id\": this.termId,\n              \"x-app-version\": \"2.9.7\",\n              \"x-net-type\": \"wifi\",\n            },\n          })\n            .then(async (res) => {\n              this.log.debug(JSON.stringify(res.data));\n              if (res.data.error_code) {\n                this.log.error(JSON.stringify(res.data));\n                return;\n              } else {\n                this.devices[id] = { ...this.devices[id], ...res.data };\n              }\n            })\n            .catch((error) => {\n              this.log.warn(error);\n              error.response && this.log.error(JSON.stringify(error.response.data));\n            });\n          //no ip via new API try old api\n          if (!this.devices[id].ip) {\n            const body = `{\n              \"requestData\": {\n                \"method\": \"multipleRequest\",\n                \"params\": {\n                  \"requests\": [{\n                    \"method\": \"getDeviceIpAddress\",\n                    \"params\": {\n                      \"network\": {\n                        \"name\": \"wan\"\n                      }\n                    }\n                  }]\n                }\n              },\n              \"deviceId\": \"${id}\"\n            }`;\n            const md5 = crypto.createHash(\"md5\").update(body).digest(\"base64\");\n            this.log.debug(md5);\n            const content = md5 + \"\\n9999999999\\nfee66616-58dd-4bcb-be79-fe092d800a21\\n/api/v2/common/passthrough\";\n            const signature = crypto.createHmac(\"sha1\", this.secret).update(content).digest(\"hex\");\n            await this.requestClient({\n              method: \"post\",\n              url: `https://n-euw1-wap-gw.tplinkcloud.com/api/v2/common/passthrough?token=${this.session.token}&termID=${this.termId}&appVer=2.8.21&locale=de_DE&appName=TP-Link_Tapo_iOS&netType=wifi&model=iPhone10%2C5&termName=iPhone&termMeta=3&brand=TPLINK&ospf=iOS%2014.8`,\n              headers: {\n                \"Content-Type\": \"application/json;UTF-8\",\n                \"Content-MD5\": md5,\n                Accept: \"*/*\",\n                \"User-Agent\": \"Tapo/2.8.21 (iPhone; iOS 14.8; Scale/3.00)\",\n                \"Accept-Language\": \"de-DE;q=1, uk-DE;q=0.9, en-DE;q=0.8\",\n                \"X-Authorization\":\n                  \"Timestamp=9999999999, Nonce=fee66616-58dd-4bcb-be79-fe092d800a21, AccessKey=4d11b6b9d5ea4d19a829adbb9714b057, Signature=\" +\n                  signature,\n              },\n              data: body,\n            })\n              .then(async (res) => {\n                this.log.debug(JSON.stringify(res.data));\n                let result: any = {};\n                if (res.data.error_code) {\n                  this.log.error(JSON.stringify(res.data));\n                } else {\n                  result = res.data.result?.responseData?.result?.responses[0]?.result?.network?.wan;\n                  result.ip = result.ipaddr;\n                  this.log.info(`Device ${id} has IP ${result.ip}`);\n                  delete result[\".name\"];\n                  delete result[\".type\"];\n                  // result = res.data.result?.responseData?.result;\n                  this.devices[id] = { ...this.devices[id], ...result };\n                }\n              })\n              .catch((error) => {\n                this.log.warn(error);\n                error.response && this.log.error(JSON.stringify(error.response.data));\n              });\n          }\n          if (!this.devices[id].ip) {\n            const ipState = await this.getStateAsync(id + \".ip\");\n            if (ipState && ipState.val) {\n              this.devices[id].ip = ipState.val;\n            } else {\n              await this.setObjectNotExistsAsync(id + \".ip\", {\n                type: \"state\",\n                common: {\n                  name: \"IP\",\n                  write: true,\n                  read: true,\n                  type: \"string\",\n                  role: \"text\",\n                },\n                native: {},\n              });\n              this.log.warn(`No IP found for ${id} put the device online or set the ip state manually`);\n            }\n          }\n          this.json2iob.parse(id, this.devices[id]);\n          if (this.devices[id].ip) {\n            const initResult = await this.initDevice(id)\n              .then(() => {\n                this.log.info(`Initialized ${id}`);\n              })\n              .catch((e) => {\n                this.log.error(e);\n              });\n            this.log.debug(`initResult ${id} ${JSON.stringify(initResult)}`);\n          }\n        }\n      })\n      .catch((error) => {\n        this.log.warn(error);\n        error.response && this.log.error(JSON.stringify(error.response.data));\n      });\n\n    await this.setObjectNotExistsAsync(\"deviceList\", {\n      type: \"state\",\n      common: {\n        name: \"Cached device list\",\n        write: false,\n        read: true,\n        type: \"string\",\n        role: \"json\",\n      },\n      native: {},\n    });\n\n    await this.setStateAsync(\"deviceList\", JSON.stringify(this.devices), true);\n  }\n  async initDevice(id: string): Promise<void> {\n    const device = this.devices[id];\n    if (!device.ip) {\n      this.log.warn(`No IP found for ${id}`);\n      return;\n    }\n    this.log.info(`Init device ${id} type ${device.deviceName} with ip ${device.ip}`);\n    let deviceObject: any;\n    if (device.deviceName === \"P100\") {\n      deviceObject = new P100(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName === \"P110\" || device.deviceName === \"P115\") {\n      deviceObject = new P110(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName === \"L530\") {\n      deviceObject = new L530(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName === \"L510E\") {\n      deviceObject = new L510E(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName === \"L520E\") {\n      deviceObject = new L520E(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName.startsWith(\"L\") || device.deviceName.startsWith(\"KL\")) {\n      deviceObject = new L510E(this.log, device.ip, this.config.username, this.config.password, 2);\n    } else if (device.deviceName.startsWith(\"C\") || device.deviceName.startsWith(\"TC\")) {\n      if (!this.config.streamusername || !this.config.streampassword) {\n        this.log.warn(`No stream username or password. No motion detection available`);\n      }\n      deviceObject = new TAPOCamera(this.log, {\n        name: device.deviceName,\n        ipAddress: device.ip,\n        password: this.config.password,\n        streamUser: this.config.streamusername,\n        streamPassword: this.config.streampassword,\n        disableStreaming: true,\n      }); //new Camera(this.log, device.ip, this.config.username, this.config.password, 2);\n\n      this.deviceObjects[id] = deviceObject;\n      const deviceInfo = await deviceObject.getDeviceInfo();\n      this.log.info(`${id} Received device info ${JSON.stringify(deviceInfo)}`);\n      this.log.debug(JSON.stringify(deviceInfo));\n      this.json2iob.parse(id, deviceInfo);\n      this.log.debug(`Init event emitter for ${id}`);\n      const eventEmitter = await deviceObject.getEventEmitter();\n      await this.setObjectNotExistsAsync(id + \".motionEvent\", {\n        type: \"state\",\n        common: {\n          name: \"Motion detected\",\n          type: \"boolean\",\n          role: \"boolean\",\n          def: false,\n          write: false,\n          read: true,\n        },\n        native: {},\n      });\n      this.log.debug('Init event listener for \"motion\"');\n      eventEmitter.addListener(\"motion\", async (motionDetected: any) => {\n        await this.setStateAsync(id + \".motionEvent\", motionDetected, true);\n        this.log.info(`[${device.deviceName}] \"Motion detected\" ${motionDetected}`);\n      });\n      return;\n    } else {\n      this.log.info(`Unknown device type ${device.deviceName} init as P100`);\n      deviceObject = new P100(this.log, device.ip, this.config.username, this.config.password, 2);\n    }\n    this.deviceObjects[id] = deviceObject;\n    await deviceObject\n      .handshake()\n      .then(async () => {\n        if (deviceObject.is_klap) {\n          await deviceObject.handshake_new().catch(() => {\n            this.log.error(\"KLAP Handshake failed\");\n            deviceObject.is_klap = false;\n            this.deviceObjects[id]._connected = false;\n          });\n        } else {\n          await deviceObject.login().catch(() => {\n            this.log.error(\"Login failed\");\n            this.deviceObjects[id]._connected = false;\n          });\n        }\n        deviceObject\n          .getDeviceInfo()\n          .then(async (sysInfo: any) => {\n            this.log.debug(JSON.stringify(sysInfo));\n            if (sysInfo.request) {\n              this.log.error(\"Malformed response sysinfo\");\n              this.log.error(JSON.stringify(sysInfo));\n              return;\n            }\n            this.json2iob.parse(id, sysInfo);\n\n            this.deviceObjects[id]._connected = true;\n            if (this.deviceObjects[id].getEnergyUsage) {\n              this.log.debug(\"Receive energy usage\");\n              const energyUsage = await this.deviceObjects[id].getEnergyUsage();\n              this.log.debug(JSON.stringify(energyUsage));\n              this.json2iob.parse(id, energyUsage);\n            }\n          })\n          .catch(() => {\n            this.log.error(\"52 - Get Device Info failed\");\n\n            this.deviceObjects[id]._connected = false;\n          });\n      })\n      .catch(() => {\n        this.log.error(\"Handshake failed\");\n        this.deviceObjects[id]._connected = false;\n      });\n  }\n\n  async updateDevices(): Promise<void> {\n    try {\n      for (const deviceId in this.deviceObjects) {\n        if (this.deviceObjects[deviceId].getStatus) {\n          this.log.debug(\"Receive camera status\");\n          const status = await this.deviceObjects[deviceId].getStatus();\n          this.log.debug(JSON.stringify(status));\n          this.json2iob.parse(deviceId, status);\n          continue;\n        }\n        if (!this.deviceObjects[deviceId]._connected) {\n          continue;\n        }\n\n        this.deviceObjects[deviceId]\n          .getDeviceInfo()\n          .then(async (sysInfo: any) => {\n            this.log.debug(JSON.stringify(sysInfo));\n            if (!sysInfo || sysInfo.name === \"Error\" || sysInfo.request) {\n              this.log.debug(\"Malformed response sysinfo\");\n              // this.log.error(JSON.stringify(sysInfo));\n              return;\n            }\n            await this.json2iob.parse(deviceId, sysInfo);\n            if (this.deviceObjects[deviceId].getEnergyUsage) {\n              this.log.debug(\"Receive energy usage\");\n              const energyUsage = await this.deviceObjects[deviceId].getEnergyUsage();\n              this.log.debug(JSON.stringify(energyUsage));\n              if (energyUsage.request) {\n                this.log.error(\"Malformed response getEnergyUsage\");\n                this.log.error(JSON.stringify(energyUsage));\n                return;\n              }\n              await this.json2iob.parse(deviceId, energyUsage);\n              const power_usage = this.deviceObjects[deviceId].getPowerConsumption();\n              if (power_usage.request) {\n                this.log.error(\"Malformed response getPowerConsumption\");\n                this.log.error(JSON.stringify(power_usage));\n                return;\n              }\n              await this.json2iob.parse(deviceId, power_usage);\n            }\n          })\n          .catch((error) => {\n            this.log.error(`Get Device Info failed for ${deviceId} - ${error}`);\n          });\n      }\n    } catch (error) {\n      this.log.warn(error);\n    }\n  }\n\n  isBase64(str: string): boolean {\n    if (str === \"\" || str.trim() === \"\") {\n      return false;\n    }\n    try {\n      return btoa(atob(str)) == str;\n    } catch (err) {\n      return false;\n    }\n  }\n  async sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n  async refreshToken(): Promise<void> {\n    this.log.debug(\"Refresh token\");\n  }\n  /**\n   * Is called when adapter shuts down - callback has to be called under any circumstances!\n   */\n  private onUnload(callback: () => void): void {\n    try {\n      this.setState(\"info.connection\", false, true);\n      this.refreshTimeout && clearTimeout(this.refreshTimeout);\n      this.reLoginTimeout && clearTimeout(this.reLoginTimeout);\n      this.refreshTokenTimeout && clearTimeout(this.refreshTokenTimeout);\n      this.updateInterval && clearInterval(this.updateInterval);\n      this.refreshTokenInterval && clearInterval(this.refreshTokenInterval);\n\n      callback();\n    } catch (e) {\n      callback();\n    }\n  }\n\n  /**\n   * Is called if a subscribed state changes\n   */\n  private async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n    if (state) {\n      if (!state.ack) {\n        const deviceId = id.split(\".\")[2];\n        const command = id.split(\".\")[4];\n        if (id.split(\".\")[3] !== \"remote\") {\n          return;\n        }\n\n        if (command === \"Refresh\") {\n          this.deviceObjects[deviceId]\n            .getDeviceInfo()\n            .then((sysInfo: any) => {\n              this.log.debug(JSON.stringify(sysInfo));\n              this.json2iob.parse(deviceId, sysInfo);\n            })\n            .catch((error) => {\n              this.log.error(`Get Device Info failed for ${deviceId} - ${error}`);\n            });\n\n          return;\n        }\n        try {\n          if (this.deviceObjects[deviceId] && this.deviceObjects[deviceId][command]) {\n            if (command === \"setColor\") {\n              const valueSplit = state.val.split(\", \");\n              const result = await this.deviceObjects[deviceId][command](valueSplit[0], valueSplit[1]);\n              this.log.info(JSON.stringify(result));\n            } else {\n              const result = await this.deviceObjects[deviceId][command](state.val);\n              this.log.info(JSON.stringify(result));\n            }\n            this.refreshTimeout && clearTimeout(this.refreshTimeout);\n            this.refreshTimeout = setTimeout(async () => {\n              await this.updateDevices();\n            }, 2 * 1000);\n          } else {\n            this.log.error(`Device ${deviceId} has no command ${command}`);\n          }\n        } catch (error) {\n          this.log.error(error);\n        }\n      } else {\n        const resultDict = { device_on: \"setPowerState\" };\n        const idArray = id.split(\".\");\n        const stateName = idArray[idArray.length - 1];\n        const deviceId = id.split(\".\")[2];\n        if (resultDict[stateName]) {\n          await this.setStateAsync(deviceId + \".remote.\" + resultDict[stateName], state.val, true);\n        }\n      }\n    }\n  }\n}\n\nif (require.main !== module) {\n  // Export the constructor in compact mode\n  module.exports = (options: Partial<utils.AdapterOptions> | undefined) => new Tapo(options);\n} else {\n  // otherwise start the instance directly\n  (() => new Tapo())();\n}\n"],
  "mappings": "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",
  "names": ["Json2iob", "axios", "https", "uuidv4", "crypto", "body", "path", "md5", "content", "signature", "res", "_a", "_b", "P100", "P110", "L530", "L510E", "L520E"]
}
