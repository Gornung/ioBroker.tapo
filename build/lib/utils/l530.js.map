{
  "version": 3,
  "sources": ["../../../src/lib/utils/l530.ts"],
  "sourcesContent": ["import L520E from \"./l520e\";\nimport { PowerUsage } from \"./powerUsage\";\nimport { ColorLightSysinfo, ConsumptionInfo } from \"./types\";\n\nexport default class L530 extends L520E {\n\n  private _colorLightSysInfo!:ColorLightSysinfo;\n  private _consumption!:ConsumptionInfo;\n\n  constructor(\n    public readonly log: any,\n    public readonly ipAddress: string,\n    public readonly email: string,\n    public readonly password: string,\n    public readonly timeout: number,\n  ) {\n    super(log, ipAddress, email, password, timeout);\n    this.log.debug('Constructing L530 on host: ' + ipAddress);\n    this._consumption = {\n      total: 0,\n      current: 0,\n    };\n  }\n\n  async getDeviceInfo(force?:boolean): Promise<ColorLightSysinfo>{\n    return super.getDeviceInfo(force).then(() => {\n      return this.getSysInfo();\n    });\n  }\n\n  async setColor(hue:number, saturation:number):Promise<boolean>{\n    if(!hue){\n      hue = 0;\n    }\n    if(!saturation){\n      saturation = 0;\n    }\n    this.log.debug('Setting color: ' + hue + ', ' + saturation);\n    const payload = '{'+\n              '\"method\": \"set_device_info\",'+\n              '\"params\": {'+\n                  '\"hue\": ' + Math.round(hue) + ','+\n                  '\"color_temp\": 0,' +\n                  '\"saturation\": ' + Math.round(saturation) +\n                  '},'+\n                  '\"requestTimeMils\": ' + Math.round(Date.now() * 1000) + ''+\n                  '};';\n\n    return this.sendRequest(payload);\n  }\n\n  protected setSysInfo(sysInfo:ColorLightSysinfo){\n    this._colorLightSysInfo = sysInfo;\n    this._colorLightSysInfo.last_update = Date.now();\n  }\n\n  public getSysInfo():ColorLightSysinfo{\n    return this._colorLightSysInfo;\n  }\n\n  async getEnergyUsage():Promise<PowerUsage>{        \n    const payload = '{'+\n                '\"method\": \"get_device_usage\",'+\n                    '\"requestTimeMils\": ' + Math.round(Date.now() * 1000) + ''+\n                    '};';\n    this.log.debug('getEnergyUsage called');\n\n    if(this.is_klap){\n      this.log.debug('getEnergyUsage is klap');\n\n      return this.handleKlapRequest(payload).then((response)=>{\n        this.log.debug('Consumption: ' + JSON.stringify(response));\n        if(response && response.result){\n          this._consumption = {\n            total: response.result.power_usage.today / 1000,\n            current: this._consumption ? response.result.power_usage.today / this.toHours(response.result.time_usage.today) : 0,\n          };\n        } else{\n          this._consumption = {\n            total: 0,\n            current: 0,\n          };\n        }\n                        \n        return response.result;\n      }).catch((error)=>{\n        if(error.message && error.message.indexOf('9999') > 0){\n          return this.reconnect().then(()=>{\n            return this.handleKlapRequest(payload).then(()=>{\n              return true;\n            });\n          });\n        }\n        return false;\n      });\n    }else{\n      return this.handleRequest(payload).then((response)=>{\n        this.log.debug('Consumption: ' + response);\n        if(response && response.result){\n          this._consumption = {\n            total: response.result.power_usage.today / 1000,\n            current: this._consumption ? response.result.power_usage.today / this.toHours(response.result.time_usage.today)  : 0,\n          };\n        } else{\n          this._consumption = {\n            total: 0,\n            current: 0,\n          };\n        }\n                        \n        return response.result;\n      }).catch((error)=>{\n        if(error.message && error.message.indexOf('9999') > 0){\n          return this.reconnect().then(()=>{\n            return this.handleRequest(payload).then(()=>{\n              return true;\n            });\n          });\n        }\n        return false;\n      });\n    }\n    \n  }\n\n  public getPowerConsumption():ConsumptionInfo{\n    if(!this.getSysInfo().device_on){\n      return {\n        total: this._consumption.total,\n        current: 0,\n      };\n    }\n    return this._consumption;\n  }\n\n  private toHours(minutes: number):number{\n    return minutes/60;\n  }\n}"],
  "mappings": "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",
  "names": ["L520E"]
}
