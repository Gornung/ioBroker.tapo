{
  "version": 3,
  "sources": ["../../../src/lib/utils/l530.ts"],
  "sourcesContent": ["import L520E from \"./l520e\";\nimport { PowerUsage } from \"./powerUsage\";\nimport { ColorLightSysinfo, ConsumptionInfo } from \"./types\";\n\nexport default class L530 extends L520E {\n  private _colorLightSysInfo!: ColorLightSysinfo;\n  private _consumption!: ConsumptionInfo;\n\n  constructor(\n    public readonly log: any,\n    public readonly ipAddress: string,\n    public readonly email: string,\n    public readonly password: string,\n    public readonly timeout: number,\n  ) {\n    super(log, ipAddress, email, password, timeout);\n    this.log.debug(\"Constructing L530 on host: \" + ipAddress);\n    this._consumption = {\n      total: 0,\n      current: 0,\n    };\n  }\n\n  async getDeviceInfo(): Promise<ColorLightSysinfo> {\n    return super.getDeviceInfo().then(() => {\n      return this.getSysInfo();\n    });\n  }\n\n  async setColor(hue: number, saturation: number): Promise<boolean> {\n    if (!hue) {\n      hue = 0;\n    }\n    if (!saturation) {\n      saturation = 0;\n    }\n    const payload =\n      \"{\" +\n      '\"method\": \"set_device_info\",' +\n      '\"params\": {' +\n      '\"hue\": ' +\n      Math.round(hue) +\n      \",\" +\n      '\"color_temp\": 0,' +\n      '\"saturation\": ' +\n      Math.round(saturation) +\n      \"},\" +\n      '\"requestTimeMils\": ' +\n      Math.round(Date.now() * 1000) +\n      \"\" +\n      \"};\";\n\n    return this.sendRequest(payload);\n  }\n\n  protected setSysInfo(sysInfo: ColorLightSysinfo) {\n    this._colorLightSysInfo = sysInfo;\n    this._colorLightSysInfo.last_update = Date.now();\n  }\n\n  public getSysInfo(): ColorLightSysinfo {\n    return this._colorLightSysInfo;\n  }\n\n  async getEnergyUsage(): Promise<PowerUsage> {\n    const payload = \"{\" + '\"method\": \"get_device_usage\",' + '\"requestTimeMils\": ' + Math.round(Date.now() * 1000) + \"\" + \"};\";\n    return this.handleRequest(payload)\n      .then((response) => {\n        if (response && response.result) {\n          this._consumption = {\n            total: response.result.power_usage.today / 1000,\n            current: this._consumption ? response.result.power_usage.today - this._consumption.current : 0,\n          };\n        } else {\n          this._consumption = {\n            total: 0,\n            current: 0,\n          };\n        }\n\n        return response.result;\n      })\n      .catch((error) => {\n        if (error.message.indexOf(\"9999\") > 0) {\n          return this.reconnect().then(() => {\n            return this.handleRequest(payload).then(() => {\n              return true;\n            });\n          });\n        }\n        return false;\n      });\n  }\n\n  public getPowerConsumption(): ConsumptionInfo {\n    return this._consumption;\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAIlB,MAAO,aAA2B,aAAAA,QAAM;AAAA,EAItC,YACkB,KACA,WACA,OACA,UACA,SAChB;AACA,UAAM,KAAK,WAAW,OAAO,UAAU,OAAO;AAN9B;AACA;AACA;AACA;AACA;AAGhB,SAAK,IAAI,MAAM,gCAAgC,SAAS;AACxD,SAAK,eAAe;AAAA,MAClB,OAAO;AAAA,MACP,SAAS;AAAA,IACX;AAAA,EACF;AAAA,EAEA,MAAM,gBAA4C;AAChD,WAAO,MAAM,cAAc,EAAE,KAAK,MAAM;AACtC,aAAO,KAAK,WAAW;AAAA,IACzB,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,SAAS,KAAa,YAAsC;AAChE,QAAI,CAAC,KAAK;AACR,YAAM;AAAA,IACR;AACA,QAAI,CAAC,YAAY;AACf,mBAAa;AAAA,IACf;AACA,UAAM,UACJ,oDAIA,KAAK,MAAM,GAAG,IACd,oCAGA,KAAK,MAAM,UAAU,IACrB,0BAEA,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI,IAE5B;AAEF,WAAO,KAAK,YAAY,OAAO;AAAA,EACjC;AAAA,EAEU,WAAW,SAA4B;AAC/C,SAAK,qBAAqB;AAC1B,SAAK,mBAAmB,cAAc,KAAK,IAAI;AAAA,EACjD;AAAA,EAEO,aAAgC;AACrC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,MAAM,iBAAsC;AAC1C,UAAM,UAAU,sDAAgE,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI,IAAS;AACrH,WAAO,KAAK,cAAc,OAAO,EAC9B,KAAK,CAAC,aAAa;AAClB,UAAI,YAAY,SAAS,QAAQ;AAC/B,aAAK,eAAe;AAAA,UAClB,OAAO,SAAS,OAAO,YAAY,QAAQ;AAAA,UAC3C,SAAS,KAAK,eAAe,SAAS,OAAO,YAAY,QAAQ,KAAK,aAAa,UAAU;AAAA,QAC/F;AAAA,MACF,OAAO;AACL,aAAK,eAAe;AAAA,UAClB,OAAO;AAAA,UACP,SAAS;AAAA,QACX;AAAA,MACF;AAEA,aAAO,SAAS;AAAA,IAClB,CAAC,EACA,MAAM,CAAC,UAAU;AAChB,UAAI,MAAM,QAAQ,QAAQ,MAAM,IAAI,GAAG;AACrC,eAAO,KAAK,UAAU,EAAE,KAAK,MAAM;AACjC,iBAAO,KAAK,cAAc,OAAO,EAAE,KAAK,MAAM;AAC5C,mBAAO;AAAA,UACT,CAAC;AAAA,QACH,CAAC;AAAA,MACH;AACA,aAAO;AAAA,IACT,CAAC;AAAA,EACL;AAAA,EAEO,sBAAuC;AAC5C,WAAO,KAAK;AAAA,EACd;AACF;",
  "names": ["L520E"]
}
